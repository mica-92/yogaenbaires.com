{{ partial "navbar.html" .}}

<div class="three-column-layout" id="el_sendero">
    <!-- Mobile sendero container (hidden on desktop) -->
    <div class="sendero-mobile-container">
        <div class="slogan-home" style="text-align: center;">
            <i>el viaje de una <b>yogini</b> por los <b>cien</b> barrios porte√±os</i>
        </div>
        <br><br>
        {{partial "images/sendero" .}}
        
    </div>

    <!-- Left column (46%) - Map -->
    <div class="map-column">
        {{partial "map.html" .}}
    </div>

    <!-- Center column (42%) - Content -->
    <div class="content-column">
        <div class="sendero-desktop">
            {{partial "images/sendero" .}}
        </div>
        <div class="sub_section">
            {{ partial "home/destacados.html" . }}
        </div>
        <br><hr><br>
        {{ if .Site.Params.home.showAllPosts }}
        <div class="sub_section" id="all-posts">
            {{partial "images/recorrido" .}}
            {{ partial "home/estudios_list.html" . }}
        </div>
        {{ end }}
    </div>

    <!-- Right column (12%) - Blog posts -->
    <div class="blog-column">
        {{ partial "home/blog_list.html" . }}
    </div>
</div>

<style>
:root {
    --red: #CD5C5C;
    --gray: #6c6464;
}

.hr {
    color: #a8a8a8;
}

/* Navigation Bar Styles */
.nav-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 88%;
    height: 60px;
    background: white;
    z-index: 100;
}

.slogan-home {
    text-align: center;
    margin-left: 0;
    font-size: 2rem;
    color: #2c2900;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
}

.nav-content {
    height: 100%;
    display: flex;
    align-items: center;
    padding: 0 20px;
}

/* Reset and base styles */
body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
}

/* Main layout container */
.three-column-layout {
    display: flex;
    width: 100%;
    height: 100vh;
    box-sizing: border-box;
    position: relative;
}

/* Column base styles */
.three-column-layout > div {
    height: 100%;
    box-sizing: border-box;
    overflow-y: auto;
    flex-shrink: 0;
}

.map-column {
    width: 46%;
    padding: 1rem;
    padding-top: calc(1rem + 60px);
}

.content-column {
    width: 42%;
    padding: 1rem;
    padding-top: calc(1rem + 60px);
    padding-right: 2rem;
}

/* Blog column adjustments */
.blog-column {
    width: 12%;
    padding: 1rem;
    position: fixed;
    right: 0;
    top: 0;
    height: 100vh;
    z-index: 101;
    overflow-y: auto;
}

/* Vertical border */
.blog-column::before {
    content: "";
    position: fixed;
    left: calc(46% + 42%);
    top: 0;
    height: 100vh;
    width: 1px;
    background-color: #e3e2e2;
    pointer-events: none;
    z-index: 102;
}

/* Hide scrollbars */
.three-column-layout > div {
    scrollbar-width: none;
    -ms-overflow-style: none;
}
.three-column-layout > div::-webkit-scrollbar {
    display: none;
}

/* Mobile sendero container - hidden by default */
.sendero-mobile-container {
    display: none;
}
.sendero-desktop {
    display: block;
}

/* Responsive Breakpoints */
@media screen and (max-width: 1200px) {
    .three-column-layout {
        flex-wrap: wrap;
    }
    
    .sendero-mobile-container {
        padding-bottom: 0 !important;
    }

    .map-column {
        width: 50%;
        order: 1;
    }
    
    .content-column {
        width: 50%;
        order: 2;
        padding-bottom: 0 !important;
        margin-bottom: 0 !important;
    }
    
    .blog-column {
        position: relative;
        width: 100%;
        height: auto;
        order: 3;
        padding-top: 0 !important;
        margin-top: 0 !important;
        right: auto;
        top: auto;
    }
    
    .blog-column::before {
        display: none;
    }
    
    .nav-bar {
        width: 100%;
    }
}

@media screen and (max-width: 1000px) {
    body, html {
        overflow-y: auto;
        height: auto;
    }
    
    .slogan-home {
        font-size: 1.6rem;
        white-space: normal;
        color: #2c2900 !important;
        margin: 0;
        text-align: center;
    }

    .three-column-layout {
        flex-direction: column;
        height: auto;
        min-height: 100vh;
        padding-right: 0;
    }
    
    .three-column-layout > div {
        overflow-y: visible;
        height: auto !important;
    }
    
    /* Mobile sendero comes first */
    .sendero-mobile-container {
        display: block;
        width: 100%;
        padding: 1rem;
        padding-left: 1.5rem !important;
        padding-right: 1.5rem !important;
        padding-top: calc(1rem + 60px);
        order: 1;
    }
    
    .sendero-desktop {
        display: none;
    }
    
    .map-column {
        width: 100%;
        height: 70vh !important; /* Increased height */
        min-height: 400px;
        max-height: none !important; /* Remove max-height restriction */
        overflow: hidden;
        order: 2;
        padding-top: 1rem;
        padding-left: 1.5rem !important;
        padding-right: 1.5rem !important;
        padding-bottom: 0 !important;
        margin-bottom: 0 !important;
    }
    
    
    .content-column {
        width: 100%;
        order: 3;
        padding-top: 1rem;
        padding-left: 1.5rem !important;
        padding-right: 1.5rem !important;
    }
    
    .blog-column {
        order: 4;
        display: block !important;
        width: 100%;
        padding: 1rem;
        margin-top: 2rem;
    }

    /* Reset all positioning */
    .map-column,
    .content-column,
    .blog-column {
        position: relative !important;
        right: auto !important;
        left: auto !important;
        top: auto !important;
        height: auto !important;
        padding: 1rem;
        margin-bottom: 2rem;
    }
    
    /* Remove the vertical border */
    .blog-column::before {
        display: none;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function enableMapInteractivity(overlay) {
        const iframe = overlay.previousElementSibling;
        iframe.style.pointerEvents = 'auto';
        overlay.style.display = 'none';
        
        setTimeout(() => {
            iframe.style.pointerEvents = 'none';
            overlay.style.display = 'block';
        }, 30000);
    }

    const initSlider = (sliderWrapper) => {
        const imageList = sliderWrapper.querySelector(".image-list");
        const slideButtons = sliderWrapper.querySelectorAll(".slide-button");
        const sliderScrollbar = sliderWrapper.parentElement.querySelector(".slider-scrollbar");
        const scrollbarThumb = sliderScrollbar.querySelector(".scrollbar-thumb");
        const maxScrollLeft = imageList.scrollWidth - imageList.clientWidth;
        
        scrollbarThumb.addEventListener("mousedown", (e) => {
            const startX = e.clientX;
            const thumbPosition = scrollbarThumb.offsetLeft;
            const maxThumbPosition = sliderScrollbar.getBoundingClientRect().width - scrollbarThumb.offsetWidth;
            
            const handleMouseMove = (e) => {
                const deltaX = e.clientX - startX;
                const newThumbPosition = thumbPosition + deltaX;
                const boundedPosition = Math.max(0, Math.min(maxThumbPosition, newThumbPosition));
                const scrollPosition = (boundedPosition / maxThumbPosition) * maxScrollLeft;
                
                scrollbarThumb.style.left = `${boundedPosition}px`;
                imageList.scrollLeft = scrollPosition;
            }
            
            const handleMouseUp = () => {
                document.removeEventListener("mousemove", handleMouseMove);
                document.removeEventListener("mouseup", handleMouseUp);
            }
            
            document.addEventListener("mousemove", handleMouseMove);
            document.addEventListener("mouseup", handleMouseUp);
        });
        
        slideButtons.forEach(button => {
            button.addEventListener("click", () => {
                const direction = button.id === "prev-slide" ? -1 : 1;
                const scrollAmount = imageList.clientWidth * direction;
                imageList.scrollBy({ left: scrollAmount, behavior: "smooth" });
            });
        });
        
        const handleSlideButtons = () => {
            slideButtons[0].style.display = imageList.scrollLeft <= 0 ? "none" : "flex";
            slideButtons[1].style.display = imageList.scrollLeft >= maxScrollLeft ? "none" : "flex";
        }
        
        const updateScrollThumbPosition = () => {
            const scrollPosition = imageList.scrollLeft;
            const thumbPosition = (scrollPosition / maxScrollLeft) * (sliderScrollbar.clientWidth - scrollbarThumb.offsetWidth);
            scrollbarThumb.style.left = `${thumbPosition}px`;
        }
        
        imageList.addEventListener("scroll", () => {
            updateScrollThumbPosition();
            handleSlideButtons();
        });
    }

    // Initialize all sliders
    document.querySelectorAll('.slider-wrapper').forEach(slider => {
        initSlider(slider);
    });
});
</script>